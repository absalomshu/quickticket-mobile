<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        
		<!--<link rel="stylesheet" type="text/css" href="css/index.css" />-->
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/jqm-datebox.core.min.css">
		<!--<link rel="stylesheet" href="css/jquery.mobile.datepicker.theme.css">
		<script src="js/jquery.mobile.datepicker.js"></script>
		<script src="js/datepicker.js"></script>
		-->
		
		<script src="js/jquery.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<script src="js/jqm-datebox.core.min.js"></script>
		<script src="js/jqm-datebox.mode.calbox.min.js"></script>
		<script src="js/jqm-datebox.i18n.js"></script>
		
		<script src="js/purl.js"></script><!--to parse urls and variables sent via url -->
		<script>
			/*$(document).on('pagebeforeshow', "#home",function(){
				$(document).on('click', "#search",function(){
					$.mobile.changePage('search-results.html',{dataUrl:"search-results.html", data:{'from':'1', 'to':'2', reloadPage:true, changeHash:true}});
				}); 
				
			}); */
			/*before showing search results
			$(document).on('pagebeforeshow', "#search-results",function(){
				var variables = $(this).data("url").split("?")[1];
				variable = variables.replace("?","");
			});*/
			
			
			$(document).ready(function(){
			
				//Get the date/time of today
				nowTime = new Date();
				
				//Initialize datebox and set default date
				$('#date').datebox({
					mode: "calbox",
					afterToday: true, //Dates available only as from the date of today
					overrideDateFormat: "%d-%m-%Y",
					"useFocus": true //make the entire input to trigger the calendar, not jus the icon
				});
				$("#date").datebox('setTheDate', nowTime).trigger('datebox', {'method':'doset'});
			})
			
			//WHEN THE SEARC BUTTON IS CLICKED
			//Catch the search form's submit
			$(document).on('click',"#search", function(){
				
				//var link = "http://127.0.0.1/quickticket/mobile/search_schedule?&departure_time=any";
				var link = "http://dev.quickticket.co/mobile/search_schedule?&departure_time=any";
				var from = $("#town_from").val();
				var from_name = $("#town_from option:selected").html();
				var to = $("#town_to").val();
				var to_name = $("#town_to option:selected").html();
				var date = $("#date").val();
			
				//check origin and destination
				if(from==to){
				 alert('Origin and destination can\'t be same.');
				 return;
				}else{
				
					//Send via ajax
					$.ajax({url: link,
						data: {
							from: from,
							to: to,
							departure_date: date
						},
						dataType:'json',
						type:'get',
						async: true,
						beforeSend: function(){
							$.mobile.loading("show"); //show the ajax spinner
						},
						complete: function(){
							$.mobile.loading("hide"); //hide the ajax spinner
						},
						success: function(data){ //for each search result, populate the list
							//if the result is an empty object, no dat was found
							if (jQuery.isEmptyObject(data))
							{
							   $('#search-results-list').append("<li class='ui-last-child'><a href='' class='ui-btn'><div>No schedules available at the moment. <br/>Please try again later.</div></a></li>");
							}else{
								$.each(data, function(index, element){

									$('#search-results-list').append("<li class='ui-first-child ui-last-child'><a href='#' class='ui-btn ui-btn-icon-right ui-icon-carat-r'><div>"+element.name+"</div><div>"+element.bus_seats+" seater  | "+element.departure_time+" </div><span class='ui-li-aside'><h2>"+element.ticket_price+" frs</h2></span></a></li>");
								});
							}
							//put the origin and destination as title of the page
							$('#route').html(from_name+' to '+to_name);
						},
						error: function(){ //If there's an error
							alert('Error: Can\'t connect. Verify your internet connection and try again.');
							$.mobile.loading("hide"); //hide the ajax spinner
							exit;
						}
					});
					
					
					//go to the search result page
					$.mobile.changePage('search-results.html',{
						dataUrl:"search-results.html", 
						data:{
							reloadPage:false, 
							changeHash:false}});
					}
				});
				
				
		
		</script>
		
		
        <title>QuickTicket | Inter-city bus tickets - Buy and reserve</title>
    </head>
    <body>
      
            
               
			   <div data-role="page" id="home">
					<div data-theme="a" data-role="header">
						
						<h1>
							Search buses
						</h1>
					</div>        
					<div role="main" class="ui-content">
						
						
						<form data-ajax="false">
						   
						    <label >From:</label>
						    <select name="town_from" id="town_from" style="background-color:white;">
						        <option value="1">Buea</option>
						        <option value="2">Bamenda</option>
						        <option value="3" selected="selected">Yaounde</option>
						        <option value="4">Douala</option>
						        <option value="5">Bafoussam</option>
						    </select>
						<br/>
						<label >To:</label>
						    <select name="town_to" id="town_to">
						        <option value="1">Buea</option>
						        <option value="2">Bamenda</option>
						        <option value="3">Yaounde</option>
						        <option value="4" selected="selected">Douala</option>
						        <option value="5">Bafoussam</option>
						    </select>
						<br/>
						<label >Choose date:</label>
						<br/>
						
						<div><input id="date" type="text"></div>
						<!--<input type="text" data-role="datebox" data-options='{"mode":"calbox"}'>-->
						<br/><br/>

						
						
						
						<a  class="ui-btn" data-role='button' id="search">Search</a>
						<!--<a href="search-results.html?from=1" class="ui-btn" data-role='button'>Search</a>-->
						   
						</form>
					</div>
					<!--<div data-theme="a" data-role="footer">
						<h1>QuickTicket &copy; 2015</h1>
					</div>   -->           
				</div>
				
				
				
				
				
			
				
         
       
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/search.js"></script>
        <script type="text/javascript">
            //app.initialize();
        </script>
    </body>
</html>
