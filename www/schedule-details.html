<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        
		<!--<link rel="stylesheet" type="text/css" href="css/index.css" />-->
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/jqm-datebox.core.min.css">
		<!--<link rel="stylesheet" href="css/jquery.mobile.datepicker.theme.css">
		<script src="js/jquery.mobile.datepicker.js"></script>
		<script src="js/datepicker.js"></script>
		-->
		
		<script src="js/jquery.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<script src="js/jqm-datebox.core.min.js"></script>
		<script src="js/jqm-datebox.mode.calbox.min.js"></script>
		<script src="js/jqm-datebox.i18n.js"></script>
		<script>
				
			//WHEN THE TICKET INFORMATION IS SUBMITTTED
			//Catch the search form's submit
			$(document).on('click',"#add-purchase", function(){
				
				var link = "http://localhost/quickticket/mobile/add_purchase";
				//var link = "http://dev.quickticket.co/mobile/search_schedule?&departure_time=any";
				var name = $("#name").val();
				var idc = $("#idc").val();
				var phone = $("#phone").val();
				var email = $("#email").val();
			
				//check origin and destination
				if(!name){
				 alert('Provide your name, phone and ID card number.');
				 return;
				}else{
				
					//Send via ajax
					$.ajax({url: link,
						data: 
						{
							name: name,
							idc: idc,
							email: email,
							phone: phone
						},
						
					
						type:'get',
						async: true,
						beforeSend: function(){
							$.mobile.loading("show"); //show the ajax spinner
							
						},
						complete: function(){
							//$.mobile.loading("hide"); //hide the ajax spinner
						},
						success: function(data){ 
						
						 alert('here');
						//for each search result, populate the list
							//if the result is an empty object, no dat was found
							if (jQuery.isEmptyObject(data))
							{	$.mobile.loading("hide"); //hide the ajax spinner
							   $('#search-results-list').append("<li class='ui-last-child'><a href='' class='ui-btn'><div>No schedules available at the moment. <br/>Please try again later.</div></a></li>");
							}else{
								$.each(data, function(index, element){
									$.mobile.loading("hide"); //hide the ajax spinner
									$('#search-results-list').append("<li class='ui-first-child ui-last-child'><a href='schedule-details.html?bus_seats="+element.bus_seats+"&ticket_price="+element.ticket_price+"&departure_time="+element.departure_time+"&parent_name="+element.parent_name+"&departure_date="+departure_date+"&from="+from+"&to="+to+"&from_name="+from_name+"&to_name="+to_name+"' id='schedule-details' class='ui-btn ui-btn-icon-right ui-icon-carat-r'><div>"+element.parent_name+"</div><div><span class='grey'>"+element.bus_seats+" seater </span> | "+element.departure_time+" </div><span class='ui-li-aside'><h2>"+element.ticket_price+" frs</h2></span></a></li>");
								});
							}
							//put the origin and destination as title of the page
							$('#route').html(from_name+' to '+to_name);
						},
						error: function(){ //If there's an error
						alert(this.url);
							alert('Error: Can\'t connect. Verify your internet connection and try again.');
							$.mobile.loading("hide"); //hide the ajax spinner
							exit;
						}
					});
							}
			});
					
		</script>
		
        <title>QuickTicket | Inter-city travel tickets - Buy and reserve</title>
    </head>
    <body>
      
            <h1>QuickTicket</h1>
				<!-- SEARCH RESULTS -->
				<div data-role="page" id="schedule-details">
					<div data-theme="a" data-role="header">
					<a href="#" data-rel="back" class="ui-btn-left ui-btn ui-icon-carat-l ui-btn-icon-notext  ui-corner-all" data-role="button" role="button">Back</a>						
					<h1 id="heading">
							Purchase information
						</h1>
					</div>        
				<div role="main" class="ui-content">
				<ul data-role="listview">
				<li class=''><a href='' class='ui-btn'>
					<div><span id='town-from'>Yde</span> to <span id='town-to'>Dla</span></div>
					<div><span id="parent-name">Vso</span> <span class='grey'>| <span id="bus-seats">4</span></span> </div>
					<div><span class='grey' id="departure-date">24jly,215</span> |</span>  <span id="departure-time">8:9AM </span></div>
					<span class='ui-li-aside'><h2 id="ticket-price">5,k00 frs</h2></span></a></li>
				</ul>
			
				   <div class="ui-body ui-body-a ui-corner-all">
					<div class="ui-field-contain">
					<h3>Contact information</h3>
						 <label for="text-12"><span class='grey'>Name:</span></label>
					         <input type="text" name="name" id="name" value="">
					    </div><div class="ui-field-contain">
					         <label for="text-12"><span class='grey'>ID Card number:</span></label>
					         <input type="text" name="idc" id="idc" value="">
					    </div>
					<div class="ui-field-contain">
					         <label for="text-12"><span class='grey'>Phone:</span></label>
					         <input type="number" name="phone" id="phone" value="">
					    </div>
					<div class="ui-field-contain">
					         <label ><span class='grey'>Email:</span></label>
					         <input type="email" name="email" id="email" value="">
					    </div>					      
					</div>
					<form>
					
					</br>
				<div class="ui-body ui-body-a ui-corner-all">	
				<div class="ui-field-contain">
				<h3>Travel information</h3>
					<div class="ui-field-contain">
					         <label for="text-12"><span class='grey'>Preferred seat number:</span></label>
					         <input type="number" name="phone" id="text-12" value="">
					    </div>
					<br/>
					
					</form>
				</div>	
				</div>
				<br/>
				<a  class="ui-btn" data-role='button' id="add-purchase" type="submit">Buy ticket</a>
				</div>
					<!--<div data-theme="a" data-role="footer">
						<h1>QuickTicket &copy; 2015</h1>
					</div>            
				</div>
				
         
       
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/search.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
    </body>
</html>
